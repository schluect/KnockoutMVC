!function(t,e){"function"==typeof define&&define.amd?define(["jquery","knockout","sammy"],e):t.komvc=e(t.$,t.ko,t.sammy)}(this,function(t,e,o){var n=n||{};return n.ko=e,n.Sammy=Sammy,n.$=jQuery,n.JSON=JSON,n.utils=function(t){return{extend:function(t,e){var o=e.prototype;e.prototype=Object.create(t.prototype);for(var n in o)e.prototype[n]=o[n];e.prototype.constructor=e,Object.defineProperty(e.prototype,"constructor",{enumerable:!1,value:e})},createTemplate:function(e,o){if(0===t("#"+e).length){var n=t("<script>");n.attr("id",e),n.attr("type","script/html"),n.html(o),t("body").append(n)}},loadTemplate:function(e,o,n){0===t("#"+e).length?t.ajax(o,function(o){var r=t("<script>");r.attr("id",e),r.attr("type","script/html"),r.html(o),t("body").append(r),n()}):n()},forEach:function(t,e){for(var o in t)if(t.hasOwnProperty(o)){var n=t[o];e(o,n)}}}}(n.$),n.ApplicationViewModelHolder=function(t){var e=null,o=function(){};return o.prototype.View=t.observable(null),o.prototype.Model=t.observable(null),function(){return e=e||new o}}(n.ko),n.Controller=function(){var t=function(){};return t.prototype.Get=function(t,e){var o=null,r=null;"string"==typeof t?(o=t.toString(),r=e):"object"==typeof t&&(r=t.model,o=t.view);var i=new n.ActionResult(this.Name,o,r);i.Process()},t.prototype.Post=function(){},t.prototype.Put=function(){},t.prototype.Delete=function(){},t.prototype.Name="",t.prototype.addAction=function(t,e){this[t]=e},t}(),n.ControllerFactory=function(){var t=function(){};return t.prototype.Controllers={},t.prototype.AddController=function(t,e){if("undefined"==typeof e)throw"controller is required";t=t.toLowerCase(),this.Controllers[t]=e},t.prototype.CreateController=function(t,e){if("undefined"==typeof t)throw"name is required";"undefined"==typeof e&&(e={index:function(){this.Get(o.name+"_index")}});var o=new n.Controller;o.Name=t,n.utils.forEach(e,function(t,e){o.addAction(t,e)});var r=(t+"controller").toLowerCase();this.Controllers[r]=o},t.prototype.GetController=function(t){return t=t.toLowerCase(),"undefined"!=typeof this.Controllers[t]?this.Controllers[t]:null},t}(),n.RouteChangeHandler=function(t){var e=function(t){this.RouteHandler=t};return e.prototype._SammyApp=null,e.prototype.RouteHandler=null,e.prototype.HandleActionResult=function(t){t.NotFound&&context.notFound(),t.Error&&context.error(t.Error)},e.prototype.StartRouteChangeHandler=function(){var e=this,o=t("#main",function(){this.get("#/:controller/:action",function(t){e.HandleActionResult(e.RouteHandler.RunAction(t.params.controller,t.params.action))}),this.get("#/:controller",function(t){e.HandleActionResult(e.RouteHandler.RunAction(t.params.controller,"index"))}),this.get("#/",function(t){e.HandleActionResult(e.RouteHandler.RunAction("home","index",t.params))})});return o.run("#/"),this._SammyApp=o,this._SammyApp},e.prototype.GetSammyApp=function(){return this._SammyApp},e}(n.Sammy),n.Run=function(t){var o=null,r=null,i=null,l=function(e){e.selector=t("[data-komvc=true]"),e.selector.length>0&&(this.UseRequire="undefined"!=typeof e.UseRequire&&e.UseRequire,this.UseRequire?u(e.Controllers,a):a(e))},u=function(t,e,o){"undefined"!=typeof t&&Array.isArray(t)&&require(t,function(){e.Controllers=arguments,o(e)})},a=function(l){o=new n.ControllerFactory,t.each(l.Controllers,function(t,e){o.CreateController(e.name,e.actions)}),r=new n.RouteHandler(o),i=new n.RouteChangeHandler(r),i.StartRouteChangeHandler(l.CustomRoutes),t(function(){t(l.selector[0]).attr('data-bind="template: { name: View, data: Model }"'),e.applyBindings(n.ApplicationViewModelHolder(),l.selector[0])})};return l}(n.$),n.RouteHandler=function(){var t=function(t){this.ControllerFactory=t};return t.prototype.ControllerFactory=null,t.prototype.ActivateController=function(t){return this.ActiveController=this.ControllerFactory.GetController(t+"controller"),"undefined"==typeof this.ActiveController?null:void 0},t.prototype.RunAction=function(t,e,o){try{var n=this.ControllerFactory.GetController(t+"controller");if("undefined"==typeof n)return{NotFound:!0};if("undefined"==typeof n[e])return{NotFound:!0};n[e](o)}catch(r){return{Error:r}}},t}(),n.ActionResult=function(t){var e=function(t,e,o){this.ProcessView(e,t),this.Model=o};return e.prototype.ViewKey=null,e.prototype.View=null,e.prototype.Model=null,e.prototype.ViewPath=null,e.prototype.ProcessView=function(t,e){if(null!==t){var o=t.split("/");o.length>1?(this.ViewPath=t,this.View=o[o.length-1]):(this.View=t,this.ViewPath="/views/"+e+"/"+this.View),this.ViewPath.indexOf(".html")<0&&(this.ViewPath+=".html"),this.View=e+"_"+this.View}},e.prototype.Process=function(){n.utils.loadTemplate(this.View,this.ViewPath,function(){t().View(this.View),t().Model(this.Model)})},e}(n.ApplicationViewModelHolder),n});